!function(){function t(t,e,n,o){let s,h,l=t.currentTime+o,r=0,f=t.createGain();if(f.gain.value=(e[0]/9)**3,e[5]&&((h=t.createOscillator()).type=e[5],h.frequency.value=(e[7]/3)**3,(s=t.createGain()).gain.value=(e[6]+3)**3,h.connect(s)),e[1]){let i=t.createBiquadFilter();i.type=e[1],i.frequency.value=2**e[2],i.Q.value=e[3]**1.5,s&&e[4]&&s.connect(i.detune),f.connect(i),i.connect(t.destination)}else f.connect(t.destination);for(let o of e[8]){let e=t.createGain();e.connect(f);let h=(o[1]/9)**3,u=(o[2]/9)**3,c=(o[3]/9)**3,a=u+c+(o[4]/6)**3;if(e.gain.setValueAtTime(0,l),e.gain.linearRampToValueAtTime(h,l+u),e.gain.setValueAtTime(h,l+u+c),e.gain.exponentialRampToValueAtTime(1e-5,l+a),o[0]){let i=t.createOscillator();i.type=o[0],i.connect(e),i.detune.value=3*(o[5]-7.5)**3,s&&o[6]&&s.connect(i.detune);let h=440*2**((n-69)/12);if(o[7]){let t=(o[8]/9)**3,e=(o[9]/9)**3,n=(o[10]/6)**3;i.frequency.linearRampToValueAtTime(0,l),i.frequency.linearRampToValueAtTime(h,l+t),i.frequency.setValueAtTime(h,l+t+e),i.frequency.exponentialRampToValueAtTime(1e-5,l+t+e+n)}else i.frequency.setValueAtTime(h,l);i.start(l),i.stop(l+a)}else{let n=t.createBufferSource();n.buffer=i(t),n.loop=1,n.connect(e),n.start(l),n.stop(l+a)}a>r&&(r=a)}h&&(h.start(l),h.stop(l+r))}function i(t){if(!y){let i=(y=t.createBuffer(1,2*t.sampleRate,t.sampleRate)).getChannelData(0);for(let t=0;t<i.length;t++)i[t]=2*Math.random()-1}return y}function e(i,e,n){let o=i[0][e];if(o.t&&(!o.i||o.o>o.i.s)){let e=60/(o.t.h||120)/4;for(let n of o.t.l)for(let o=0;o<n.u.length;o++)n.u[o]&&t(i.Audio,n.m,n.u[o],o*e);o.i=o.t,o.o=0}else o.o+=n;o.t=o.v}function n(t,i){return t[0]=-i[0],t[1]=-i[1],t}function o(t,i){var e,n;(e=i.M)[0]=(n=t.p)[4],e[1]=n[5],i._[0]=i.M[0]-i.g[0]/2,i._[1]=i.M[1]-i.g[1]/2,i.C[0]=i.M[0]+i.g[0]/2,i.C[1]=i.M[1]+i.g[1]/2}function s(t,i,e){for(let l=0;l<e;l++){let e=i[l];if((o=t)._[0]<(s=e).C[0]&&o.C[0]>s._[0]&&o._[1]<s.C[1]&&o.C[1]>s._[1]){let i=h(t,e);t.S.push({k:e,A:i}),e.S.push({k:t,A:n([0,0],i)})}}var o,s}function h(t,i){let e=t.M[0]-i.M[0],n=t.g[0]/2+i.g[0]/2-Math.abs(e),o=t.M[1]-i.M[1],s=t.g[1]/2+i.g[1]/2-Math.abs(o);return n<s?[n*Math.sign(e),0]:[0,s*Math.sign(o)]}function l(t,i){let e=t[2][i],n=t[8][i],o=t[1][i];if(n.T[0]<0&&(n.T[0]=0,e.U[0]=-e.U[0]),n.T[0]>t.D&&(n.T[0]=t.D,e.U[0]=-e.U[0]),n.T[1]<0&&(n.T[1]=0,e.U[1]=-e.U[1]),n.T[1]>t.$&&(n.T[1]=t.$,e.U[1]=-e.U[1]),o.S.length>0){let i=o.S[0];if(i.A[0]&&(n.T[0]+=i.A[0],e.U[0]=-e.U[0]),i.A[1]&&(n.T[1]+=i.A[1],e.U[1]=-e.U[1]),64&t.p[i.k.H]){let n=t[6][i.k.H];n.U&&(e.U[0]+=n.U[0],e.U[1]+=n.U[1])}!function(t,i){let e=i[0],n=i[1],o=e*e+n*n;o>0&&(o=1/Math.sqrt(o)),t[0]=i[0]*o,t[1]=i[1]*o}(e.U,e.U)}t[6][i].U=e.U}function r(t,i){t[1][i].S.length>0&&t.W(i)}function f(t,i){let e=t[8][i],n=t[4][i],o=t[6][i],s=e.T[0];s<n.F/2?(e.T[0]=n.F/2,e.I=1):t.D-n.F/2<s?(e.T[0]=t.D-n.F/2,e.I=1):(t.O.N&&!t.O.R&&(o.U=[-1,0]),t.O.R&&!t.O.N&&(o.U=[1,0]))}function u(t,i){t.q.fillStyle=i.K,t.q.fillRect(-i.F/2,-i.j/2,i.F,i.j)}function c(t,i,e){let n=t[6][i];if(n.U){let o=t[8][i];o.T[0]+=n.U[0]*n.B*e,o.T[1]+=n.U[1]*n.B*e,o.I=1,n.U=void 0}}function a(t,...i){return t.reduce((t,e)=>t+function(t){let i=t.shift();return 0==i||void 0===i?"":Array.isArray(i)?i.join(""):i}(i)+e)}function d(t,i){let e=a`<divstyle="position: absolute;top: 0;background-color: #000;color: #fff;"></div>`;e!==M&&(t.G.innerHTML=M=e)}function m(t=1,i){return(e,n)=>{e.p[n]|=2,e[1][n]={H:n,J:1,L:t,g:i,_:[0,0],C:[0,0],M:[0,0],S:[]}}}function w(t,i,e){return(n,o)=>{n.p[o]|=32,n[5][o]={P:1,F:t,j:i,K:e}}}function v(t){return(i,e)=>{i.p[e]|=64,i[6][e]={B:t}}}let y,M,p=document.getElementById("tick"),_=document.getElementById("fps"),g={V:[(C=-Math.random()*Math.PI,(t,i)=>{t.p[i]|=4,t[2][i]={U:[Math.cos(C),Math.sin(C)]}}),v(300),m(1,[20,20]),w(20,20,"orange")]};var C;let S={V:[(t,i)=>{t.p[i]|=16,t[4][i]={F:100}},v(500),m(1,[100,20]),w(100,20,"red")]},k=new class{constructor(){this.p=[],this[0]=[],this[1]=[],this[2]=[],this[3]=[],this[4]=[],this[5]=[],this[6]=[],this[7]=[],this[8]=[],this.D=window.innerWidth,this.$=window.innerHeight,this.G=document.querySelector("main"),this.Audio=new AudioContext,this.O={mouse_x:0,mouse_y:0},this.InputEvent={mouse_x:0,mouse_y:0,wheel_y:0},this.X=[1,.3,.3,1],this.Y=0,document.addEventListener("visibilitychange",()=>document.hidden?this.Z():this.tt()),window.addEventListener("keydown",t=>this.O[t.code]=1),window.addEventListener("keyup",t=>this.O[t.code]=0),this.G.addEventListener("contextmenu",t=>t.preventDefault()),this.G.addEventListener("mousedown",t=>{this.O[`mouse_${t.button}`]=1,this.InputEvent[`mouse_${t.button}_down`]=1}),this.G.addEventListener("mouseup",t=>{this.O[`mouse_${t.button}`]=0,this.InputEvent[`mouse_${t.button}_up`]=1}),this.G.addEventListener("mousemove",t=>{this.O.mouse_x=t.offsetX,this.O.mouse_y=t.offsetY,this.InputEvent.mouse_x=t.movementX,this.InputEvent.mouse_y=t.movementY}),this.G.addEventListener("wheel",t=>{this.InputEvent.wheel_y=t.deltaY}),this.G.addEventListener("click",()=>this.G.requestPointerLock());let t=document.querySelector("canvas");t.width=this.D,t.height=this.$,this.q=t.getContext("2d")}it(t=0){for(let i=0;i<1e4;i++)if(!this.p[i])return this.p[i]=t,i;throw Error("No more entities available.")}et(t){let i=performance.now();!function(t,i){for(let i=0;i<t.p.length;i++)336==(336&t.p[i])&&f(t,i)}(this),function(t,i){for(let i=0;i<t.p.length;i++)326==(326&t.p[i])&&l(t,i)}(this),function(t,i){for(let i=0;i<t.p.length;i++)266==(266&t.p[i])&&r(t,i)}(this),function(t,i){for(let e=0;e<t.p.length;e++)320==(320&t.p[e])&&c(t,e,i)}(this,t),function(t,i){for(let i=0;i<t.p.length;i++)256==(256&t.p[i])&&(n=void 0,o=void 0,(e=t[8][i]).I&&(e.I=0,function t(i){for(let e of i.nt)e.I=1,t(e)}(e),o=e.T,(n=e.p)[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=o[0],n[5]=o[1],function(t,i,e){let n=i[0],o=i[1],s=i[2],h=i[3],l=i[4],r=i[5],f=Math.sin(e),u=Math.cos(e);t[0]=n*u+s*f,t[1]=o*u+h*f,t[2]=n*-f+s*u,t[3]=o*-f+h*u,t[4]=l,t[5]=r}(e.p,e.p,e.ot),function(t,i,e){let n=i[1],o=i[2],s=i[3],h=i[4],l=i[5],r=e[0],f=e[1];t[0]=i[0]*r,t[1]=n*r,t[2]=o*f,t[3]=s*f,t[4]=h,t[5]=l}(e.p,e.p,e.st),e.ht&&function(t,i,e){let n=i[0],o=i[1],s=i[2],h=i[3],l=i[4],r=i[5],f=e[0],u=e[1],c=e[2],a=e[3],d=e[4],m=e[5];t[0]=n*f+s*u,t[1]=o*f+h*u,t[2]=n*c+s*a,t[3]=o*c+h*a,t[4]=n*d+s*m+l,t[5]=o*d+h*m+r}(e.p,e.ht.p,e.p),function(t,i){let e=i[0],n=i[1],o=i[2],s=i[3],h=i[4],l=i[5],r=e*s-n*o;r&&(t[0]=s*(r=1/r),t[1]=-n*r,t[2]=-o*r,t[3]=e*r,t[4]=(o*l-s*h)*r,t[5]=(n*h-e*l)*r)}(e.lt,e.p)));var e,n,o}(this),function(t,i){let e=[],n=[];for(let i=0;i<t.p.length;i++)if(258==(258&t.p[i])){let s=t[8][i],h=t[1][i];h.S=[],h.J?(h.J=0,o(s,h)):h.L?(o(s,h),n.push(h)):e.push(h)}for(let t=0;t<n.length;t++)s(n[t],e,e.length),s(n[t],n,t)}(this),function(t,i){for(let n=0;n<t.p.length;n++)1==(1&t.p[n])&&e(t,n,i)}(this,t),function(t,i){t.q.resetTransform(),t.q.clearRect(0,0,t.D,t.$);for(let i=0;i<t.p.length;i++)if(288==(288&t.p[i])){let e=t[8][i];t.q.setTransform(e.p[0],e.p[1],e.p[2],e.p[3],e.p[4],e.p[5]);let n=t[5][i];switch(n.P){case 1:u(t,n)}}}(this),d(this),function(t,i){p&&(p.textContent=(1e3*i).toFixed(1)),_&&(_.textContent=(1/i).toFixed())}(0,t),function(t,i,e){e&&(e.textContent=i.toFixed(1))}(0,performance.now()-i,document.querySelector("#frame"))}tt(){let t=performance.now(),i=e=>{this.et((e-t)/1e3);for(let t in this.InputEvent)this.InputEvent[t]=0;t=e,this.Y=requestAnimationFrame(i)};this.Z(),this.Audio.resume(),i(t)}Z(){this.Audio.suspend(),cancelAnimationFrame(this.Y)}rt({T:t,ot:i,st:e,V:n=[],nt:o=[]}){let s=this.it();!function(t=[0,0],i=0,e=[1,1]){return(n,o)=>{n.p[o]|=256,n[8][o]={H:o,p:[1,0,0,1,0,0],lt:[1,0,0,1,0,0],T:t,ot:i,st:e,nt:[],I:1}}}(t,i,e)(this,s);for(let t of n)t(this,s);let h=this[8][s];for(let t of o){let i=this.rt(t),e=this[8][i];e.ht=h,h.nt.push(e)}return s}W(t){if(256&this.p[t])for(let i of this[8][t].nt)this.W(i.H);this.p[t]=0}};!function(t){t.p=[],t.rt({T:[t.D/2,t.$-20],...S}),t.rt({T:[t.D/2,t.$-100],...g});let i=(t.D-500-40)/2;for(let e=0;e<5;e++){let n=110+30*e;for(let e=0;e<5;e++)t.rt({T:[i+110*e+50,n],V:[(t,i)=>{t.p[i]|=8,t[3][i]={}},m(0,[100,20]),w(100,20,"green")]})}}(k),k.tt(),window.$=(...t)=>void 0,window.game=k}();
