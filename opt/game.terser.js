!function(){function t(t,e,n,o){let s,h,l=t.currentTime+o,r=0,f=t.createGain();if(f.gain.value=(e[0]/9)**3,e[5]&&((h=t.createOscillator()).type=e[5],h.frequency.value=(e[7]/3)**3,(s=t.createGain()).gain.value=(e[6]+3)**3,h.connect(s)),e[1]){let i=t.createBiquadFilter();i.type=e[1],i.frequency.value=2**e[2],i.Q.value=e[3]**1.5,s&&e[4]&&s.connect(i.detune),f.connect(i),i.connect(t.destination)}else f.connect(t.destination);for(let o of e[8]){let e=t.createGain();e.connect(f);let h=(o[1]/9)**3,u=(o[2]/9)**3,c=(o[3]/9)**3,a=u+c+(o[4]/6)**3;if(e.gain.setValueAtTime(0,l),e.gain.linearRampToValueAtTime(h,l+u),e.gain.setValueAtTime(h,l+u+c),e.gain.exponentialRampToValueAtTime(1e-5,l+a),o[0]){let i=t.createOscillator();i.type=o[0],i.connect(e),i.detune.value=3*(o[5]-7.5)**3,s&&o[6]&&s.connect(i.detune);let h=440*2**((n-69)/12);if(o[7]){let t=(o[8]/9)**3,e=(o[9]/9)**3,n=(o[10]/6)**3;i.frequency.linearRampToValueAtTime(0,l),i.frequency.linearRampToValueAtTime(h,l+t),i.frequency.setValueAtTime(h,l+t+e),i.frequency.exponentialRampToValueAtTime(1e-5,l+t+e+n)}else i.frequency.setValueAtTime(h,l);i.start(l),i.stop(l+a)}else{let n=t.createBufferSource();n.buffer=i(t),n.loop=1,n.connect(e),n.start(l),n.stop(l+a)}a>r&&(r=a)}h&&(h.start(l),h.stop(l+r))}function i(t){if(!y){let i=(y=t.createBuffer(1,2*t.sampleRate,t.sampleRate)).getChannelData(0);for(let t=0;t<i.length;t++)i[t]=2*Math.random()-1}return y}function e(i,e,n){let o=i[0][e];if(o.t&&(!o.i||o.o>o.i.s)){let e=60/(o.t.h||120)/4;for(let n of o.t.l)for(let o=0;o<n.u.length;o++)n.u[o]&&t(i.Audio,n.m,n.u[o],o*e);o.i=o.t,o.o=0}else o.o+=n;o.t=o.v}function n(t,i){return t[0]=-i[0],t[1]=-i[1],t}function o(t,i){var e,n;(e=i.p)[0]=(n=t.M)[4],e[1]=n[5],i._[0]=i.p[0]-i.g[0]/2,i._[1]=i.p[1]-i.g[1]/2,i.C[0]=i.p[0]+i.g[0]/2,i.C[1]=i.p[1]+i.g[1]/2}function s(t,i,e){for(let l=0;l<e;l++){let e=i[l];if((o=t)._[0]<(s=e).C[0]&&o.C[0]>s._[0]&&o._[1]<s.C[1]&&o.C[1]>s._[1]){let i=h(t,e);t.S.push({k:e,A:i}),e.S.push({k:t,A:n([0,0],i)})}}var o,s}function h(t,i){let e=t.p[0]-i.p[0],n=t.g[0]/2+i.g[0]/2-Math.abs(e),o=t.p[1]-i.p[1],s=t.g[1]/2+i.g[1]/2-Math.abs(o);return n<s?[n*Math.sign(e),0]:[0,s*Math.sign(o)]}function l(t,i){let e=t[8][i],n=t[6][i],o=t[1][i];if(e.T[0]<0&&(e.T[0]=0,n.U[0]=-n.U[0]),e.T[0]>t.D&&(e.T[0]=t.D,n.U[0]=-n.U[0]),e.T[1]<0&&(e.T[1]=0,n.U[1]=-n.U[1]),e.T[1]>t.$&&(e.T[1]=t.$,n.U[1]=-n.U[1]),o.S.length>0){let t=o.S[0];if(t.A[0]){e.T[0]+=t.A[0];let i=o.p[1]-t.k.p[1],s=t.k.g[1]/2;n.U[0]=-n.U[0],n.U[1]=i/s}t.A[1]&&(e.T[1]+=t.A[1],n.U[0]=(o.p[0]-t.k.p[0])/(t.k.g[0]/2),n.U[1]=-n.U[1]),function(t,i){let e=i[0],n=i[1],o=e*e+n*n;o>0&&(o=1/Math.sqrt(o)),t[0]=i[0]*o,t[1]=i[1]*o}(n.U,n.U)}}function r(t,i){t[1][i].S.length>0&&t.H(i)}function f(t,i){let e=t[8][i],n=t[4][i],o=e.T[0]+t.InputEvent.mouse_x;e.T[0]=o<n.W/2?n.W/2:t.D-n.W/2<o?t.D-n.W/2:o,e.F=1}function u(t,i){t.I.fillStyle=i.N,t.I.fillRect(-i.W/2,-i.O/2,i.W,i.O)}function c(t,i,e){let n=t[8][i],o=t[6][i];n.T[0]+=o.U[0]*o.R*e,n.T[1]+=o.U[1]*o.R*e,n.F=1}function a(t,...i){return t.reduce((t,e)=>t+function(t){let i=t.shift();return 0==i||void 0===i?"":Array.isArray(i)?i.join(""):i}(i)+e)}function d(t,i){let e=a`<divstyle="position: absolute;top: 0;background-color: #000;color: #fff;"></div>`;e!==v&&(t.q.innerHTML=v=e)}function m(t=1,i){return(e,n)=>{e.M[n]|=2,e[1][n]={K:n,j:1,B:t,g:i,_:[0,0],C:[0,0],p:[0,0],S:[]}}}function w(t,i,e){return(n,o)=>{n.M[o]|=32,n[5][o]={G:1,W:t,O:i,N:e}}}let y,v,p=document.getElementById("tick"),M=document.getElementById("fps"),_={J:[(t,i)=>{t.M[i]|=4,t[2][i]={}},(t,i)=>{t.M[i]|=64,t[6][i]={U:[Math.cos(1),Math.sin(1)],R:300}},m(1,[20,20]),w(20,20,"orange")]},g={J:[(t,i)=>{t.M[i]|=16,t[4][i]={W:100}},m(1,[100,20]),w(100,20,"red")]},C=new class{constructor(){this.M=[],this[0]=[],this[1]=[],this[2]=[],this[3]=[],this[4]=[],this[5]=[],this[6]=[],this[7]=[],this[8]=[],this.D=window.innerWidth,this.$=window.innerHeight,this.q=document.querySelector("main"),this.Audio=new AudioContext,this.L={mouse_x:0,mouse_y:0},this.InputEvent={mouse_x:0,mouse_y:0,wheel_y:0},this.P=[1,.3,.3,1],this.V=0,document.addEventListener("visibilitychange",()=>document.hidden?this.X():this.Y()),window.addEventListener("keydown",t=>this.L[t.code]=1),window.addEventListener("keyup",t=>this.L[t.code]=0),this.q.addEventListener("contextmenu",t=>t.preventDefault()),this.q.addEventListener("mousedown",t=>{this.L[`mouse_${t.button}`]=1,this.InputEvent[`mouse_${t.button}_down`]=1}),this.q.addEventListener("mouseup",t=>{this.L[`mouse_${t.button}`]=0,this.InputEvent[`mouse_${t.button}_up`]=1}),this.q.addEventListener("mousemove",t=>{this.L.mouse_x=t.offsetX,this.L.mouse_y=t.offsetY,this.InputEvent.mouse_x=t.movementX,this.InputEvent.mouse_y=t.movementY}),this.q.addEventListener("wheel",t=>{this.InputEvent.wheel_y=t.deltaY}),this.q.addEventListener("click",()=>this.q.requestPointerLock());let t=document.querySelector("canvas");t.width=this.D,t.height=this.$,this.I=t.getContext("2d")}Z(t=0){for(let i=0;i<1e4;i++)if(!this.M[i])return this.M[i]=t,i;throw Error("No more entities available.")}tt(t){let i=performance.now();!function(t,i){for(let i=0;i<t.M.length;i++)272==(272&t.M[i])&&f(t,i)}(this),function(t,i){for(let i=0;i<t.M.length;i++)326==(326&t.M[i])&&l(t,i)}(this),function(t,i){for(let i=0;i<t.M.length;i++)266==(266&t.M[i])&&r(t,i)}(this),function(t,i){for(let e=0;e<t.M.length;e++)320==(320&t.M[e])&&c(t,e,i)}(this,t),function(t,i){for(let i=0;i<t.M.length;i++)256==(256&t.M[i])&&(n=void 0,o=void 0,(e=t[8][i]).F&&(e.F=0,function t(i){for(let e of i.it)e.F=1,t(e)}(e),o=e.T,(n=e.M)[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=o[0],n[5]=o[1],function(t,i,e){let n=i[0],o=i[1],s=i[2],h=i[3],l=i[4],r=i[5],f=Math.sin(e),u=Math.cos(e);t[0]=n*u+s*f,t[1]=o*u+h*f,t[2]=n*-f+s*u,t[3]=o*-f+h*u,t[4]=l,t[5]=r}(e.M,e.M,e.et),function(t,i,e){let n=i[1],o=i[2],s=i[3],h=i[4],l=i[5],r=e[0],f=e[1];t[0]=i[0]*r,t[1]=n*r,t[2]=o*f,t[3]=s*f,t[4]=h,t[5]=l}(e.M,e.M,e.nt),e.ot&&function(t,i,e){let n=i[0],o=i[1],s=i[2],h=i[3],l=i[4],r=i[5],f=e[0],u=e[1],c=e[2],a=e[3],d=e[4],m=e[5];t[0]=n*f+s*u,t[1]=o*f+h*u,t[2]=n*c+s*a,t[3]=o*c+h*a,t[4]=n*d+s*m+l,t[5]=o*d+h*m+r}(e.M,e.ot.M,e.M),function(t,i){let e=i[0],n=i[1],o=i[2],s=i[3],h=i[4],l=i[5],r=e*s-n*o;r&&(t[0]=s*(r=1/r),t[1]=-n*r,t[2]=-o*r,t[3]=e*r,t[4]=(o*l-s*h)*r,t[5]=(n*h-e*l)*r)}(e.st,e.M)));var e,n,o}(this),function(t,i){let e=[],n=[];for(let i=0;i<t.M.length;i++)if(258==(258&t.M[i])){let s=t[8][i],h=t[1][i];h.S=[],h.j?(h.j=0,o(s,h)):h.B?(o(s,h),n.push(h)):e.push(h)}for(let t=0;t<n.length;t++)s(n[t],e,e.length),s(n[t],n,t)}(this),function(t,i){for(let n=0;n<t.M.length;n++)1==(1&t.M[n])&&e(t,n,i)}(this,t),function(t,i){t.I.resetTransform(),t.I.clearRect(0,0,t.D,t.$);for(let i=0;i<t.M.length;i++)if(288==(288&t.M[i])){let e=t[8][i];t.I.setTransform(e.M[0],e.M[1],e.M[2],e.M[3],e.M[4],e.M[5]);let n=t[5][i];switch(n.G){case 1:u(t,n)}}}(this),d(this),function(t,i){p&&(p.textContent=(1e3*i).toFixed(1)),M&&(M.textContent=(1/i).toFixed())}(0,t),function(t,i,e){e&&(e.textContent=i.toFixed(1))}(0,performance.now()-i,document.querySelector("#frame"))}Y(){let t=performance.now(),i=e=>{this.tt((e-t)/1e3);for(let t in this.InputEvent)this.InputEvent[t]=0;t=e,this.V=requestAnimationFrame(i)};this.X(),this.Audio.resume(),i(t)}X(){this.Audio.suspend(),cancelAnimationFrame(this.V)}ht({T:t,et:i,nt:e,J:n=[],it:o=[]}){let s=this.Z();!function(t=[0,0],i=0,e=[1,1]){return(n,o)=>{n.M[o]|=256,n[8][o]={K:o,M:[1,0,0,1,0,0],st:[1,0,0,1,0,0],T:t,et:i,nt:e,it:[],F:1}}}(t,i,e)(this,s);for(let t of n)t(this,s);let h=this[8][s];for(let t of o){let i=this.ht(t),e=this[8][i];e.ot=h,h.it.push(e)}return s}H(t){if(256&this.M[t])for(let i of this[8][t].it)this.H(i.K);this.M[t]=0}};!function(t){t.M=[],t.ht({T:[t.D/2,t.$-20],...g}),t.ht({T:[t.D/2,t.$-100],..._});let i=(t.D-500-40)/2;for(let e=0;e<5;e++){let n=110+30*e;for(let e=0;e<5;e++)t.ht({T:[i+110*e+50,n],J:[(t,i)=>{t.M[i]|=8,t[3][i]={}},m(0,[100,20]),w(100,20,"green")]})}}(C),C.Y(),window.$=(...t)=>void 0,window.game=C}();
